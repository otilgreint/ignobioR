Taxon = Sub.Repert,
Lat = Latitudine,
Long = Longitudin,
uncertainty = Accuratezz,
year = Anno.Reper
) %>%
filter(
!is.na(Taxon),
!is.na(Lat),
!is.na(Long),
!is.na(uncertainty),
!is.na(year)
)
}
# Apply cleaning to both
floristic_initial <- clean_floristic(floristic_ante_raw)
floristic_updated <- clean_floristic(floristic_2025_raw)
library(sf)
library(dplyr)
# ============================================================================
# LOAD DATA WITH NEW STANDARDIZED NOMENCLATURE
# ============================================================================
# Baseline (before 2025 fieldwork)
floristic_ante_raw <- st_read("C:/Users/Giuseppe Antonelli/Documents/Progetti/MSRM/wiki parco/01_dec_2025-ante.shp")
# Updated (after 2025 fieldwork)
floristic_post_raw <- st_read("C:/Users/Giuseppe Antonelli/Documents/Progetti/MSRM/wiki parco/01_dec_2025-post_BIAS.shp")
# Study area (same as before)
study_area <- st_read("C:/Users/Giuseppe Antonelli/Documents/progetti/MSRM/test-na/confini-buffer125_finale.shp")
if (is.na(st_crs(study_area))) {
st_crs(study_area) <- 4326
}
# ============================================================================
# CLEAN AND RENAME WITH NEW COLUMN NAMES
# ============================================================================
clean_floristic_new <- function(data) {
data %>%
rename(
uncertainty = Accuratezz,
year = Anno.Reper,  # Note: might be Anno_Reper depending on shapefile
Lat = Lat.Wgs84,
Long = Lon.Wgs84,
Taxon = Combinatio
) %>%
filter(
!is.na(Taxon),
!is.na(Lat),
!is.na(Long),
!is.na(uncertainty),
!is.na(year)
)
}
# Check actual column names first
cat("Checking column names in ante file:\n")
print(names(floristic_ante_raw))
cat("\nChecking column names in post file:\n")
print(names(floristic_post_raw))
# Apply cleaning (adjust column names based on output above if needed)
floristic_initial <- clean_floristic_new(floristic_ante_raw)
floristic_updated <- clean_floristic_new(floristic_post_raw)
# ============================================================================
# SUMMARY OF STANDARDIZED DATA
# ============================================================================
cat("\n=== STANDARDIZED DATA SUMMARY ===\n\n")
cat("BASELINE (ante - before 2025):\n")
cat("  Total records:", nrow(floristic_initial), "\n")
cat("  Unique taxa:", length(unique(floristic_initial$Taxon)), "\n")
cat("  Year range:", range(floristic_initial$year), "\n\n")
cat("UPDATED (post - after 2025):\n")
cat("  Total records:", nrow(floristic_updated), "\n")
cat("  Unique taxa:", length(unique(floristic_updated$Taxon)), "\n")
cat("  Year range:", range(floristic_updated$year), "\n\n")
cat("CHANGES:\n")
cat("  New observations added:", nrow(floristic_updated) - nrow(floristic_initial), "\n")
# Check for truly new taxa
taxa_initial <- unique(floristic_initial$Taxon)
taxa_updated <- unique(floristic_updated$Taxon)
new_taxa <- setdiff(taxa_updated, taxa_initial)
cat("  New taxa discovered:", length(new_taxa), "\n")
if (length(new_taxa) > 0 && length(new_taxa) <= 30) {
cat("\n  New taxa list:\n")
cat(paste("   -", sort(new_taxa)), sep = "\n")
}
# Check for infraspecific taxa
has_infraspecific <- function(taxon_name) {
name_lower <- tolower(as.character(taxon_name))
grepl("subsp\\.|var\\.|f\\.", name_lower)
}
n_infra_initial <- sum(sapply(floristic_initial$Taxon, has_infraspecific))
n_infra_updated <- sum(sapply(floristic_updated$Taxon, has_infraspecific))
cat("\n  Records with infraspecific ranks (subsp/var):\n")
cat("    Initial:", n_infra_initial, "\n")
cat("    Updated:", n_infra_updated, "\n")
# ============================================================================
# VISUAL CHECK
# ============================================================================
# Identify new records
floristic_initial$record_id <- paste(
floristic_initial$Taxon,
round(floristic_initial$Lat, 6),
round(floristic_initial$Long, 6),
floristic_initial$year,
sep = "_"
)
floristic_updated$record_id <- paste(
floristic_updated$Taxon,
round(floristic_updated$Lat, 6),
round(floristic_updated$Long, 6),
floristic_updated$year,
sep = "_"
)
new_records <- floristic_updated %>%
filter(!record_id %in% floristic_initial$record_id)
cat("\nNew records (not in baseline):", nrow(new_records), "\n")
cat("  From 2025:", sum(new_records$year == 2025), "\n")
cat("  From before 2025:", sum(new_records$year < 2025), "\n")
# Plot
plot(st_geometry(study_area), border = "black", lwd = 2,
main = "2025 Fieldwork - Standardized Nomenclature")
plot(st_geometry(floristic_initial), add = TRUE, col = "gray60", pch = 20, cex = 0.3)
plot(st_geometry(new_records), add = TRUE, col = "red", pch = 20, cex = 0.8)
legend("topright",
legend = c("Baseline (ante)", "New records (post)"),
col = c("gray60", "red"),
pch = 20,
pt.cex = c(0.3, 0.8))
# ============================================================================
# RUN MRFI COMPARISON
# ============================================================================
cat("\n=== RUNNING MRFI COMPARISON ===\n\n")
comparison_standardized <- compare_mrfi(
data_flor_initial = floristic_initial,
data_flor_updated = floristic_updated,
site = study_area,
tau = 20,
cellsize = 1000,
year_initial = max(floristic_initial$year),
year_updated = 2025,
use_coverage_weighting = FALSE,
output_prefix = "MSRM_2025_STANDARDIZED_NOMENCLATURE"
)
set.seed(123)
floristic_initial_subset <- floristic_initial[sample(nrow(floristic_initial),
size = floor(nrow(floristic_initial) * 0.25)), ]
floristic_updated_subset <- floristic_updated[sample(nrow(floristic_updated),
size = floor(nrow(floristic_updated) * 0.25)), ]
comparison_test <- compare_mrfi(
data_flor_initial = floristic_initial_subset,
data_flor_updated = floristic_updated_subset,
site = study_area,
tau = 20,
cellsize = 1000,
year_initial = max(floristic_initial_subset$year),
year_updated = 2025,
use_coverage_weighting = FALSE,
output_prefix = "MSRM_2025_TEST_QUADRANT-BIAS-OK"
)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
set.seed(123)
floristic_initial_subset <- floristic_initial[sample(nrow(floristic_initial),
size = floor(nrow(floristic_initial) * 0.25)), ]
floristic_updated_subset <- floristic_updated[sample(nrow(floristic_updated),
size = floor(nrow(floristic_updated) * 0.25)), ]
comparison_test <- compare_mrfi(
data_flor_initial = floristic_initial_subset,
data_flor_updated = floristic_updated_subset,
site = study_area,
tau = 20,
cellsize = 1000,
year_initial = max(floristic_initial_subset$year),
year_updated = 2025,
use_coverage_weighting = FALSE,
output_prefix = "MSRM_2025_TEST_QUADRANT-BIAS-OK"
)
comparison_test <- compare_mrfi(
data_flor_initial = floristic_initial,
data_flor_updated = floristic_updated,
site = study_area,
tau = 20,
cellsize = 1000,
year_initial = max(floristic_initial_subset$year),
year_updated = 2025,
use_coverage_weighting = FALSE,
output_prefix = "MSRM_2025_TEST_QUADRANT-BIAS-FULL"
)
library(sf)
library(dplyr)
# ============================================================================
# LOAD DATA WITH NEW STANDARDIZED NOMENCLATURE
# ============================================================================
# Baseline (before 2025 fieldwork)
floristic_ante_raw <- st_read("C:/Users/Giuseppe Antonelli/Documents/Progetti/MSRM/wiki parco/01_dec_2025-ante.shp")
# Updated (after 2025 fieldwork)
floristic_post_raw <- st_read("C:/Users/Giuseppe Antonelli/Documents/Progetti/MSRM/wiki parco/01_dec_2025-post_BIAS.shp")
# Study area (same as before)
study_area <- st_read("C:/Users/Giuseppe Antonelli/Documents/progetti/MSRM/test-na/confini-buffer125_finale.shp")
if (is.na(st_crs(study_area))) {
st_crs(study_area) <- 4326
}
# ============================================================================
# CLEAN AND RENAME WITH NEW COLUMN NAMES
# ============================================================================
clean_floristic_new <- function(data) {
data %>%
rename(
uncertainty = Accuratezz,
year = Anno.Reper,  # Note: might be Anno_Reper depending on shapefile
Lat = Lat.Wgs84,
Long = Lon.Wgs84,
Taxon = Combinatio
) %>%
filter(
!is.na(Taxon),
!is.na(Lat),
!is.na(Long),
!is.na(uncertainty),
!is.na(year)
)
}
# Check actual column names first
cat("Checking column names in ante file:\n")
print(names(floristic_ante_raw))
cat("\nChecking column names in post file:\n")
print(names(floristic_post_raw))
# Apply cleaning (adjust column names based on output above if needed)
floristic_initial <- clean_floristic_new(floristic_ante_raw)
floristic_updated <- clean_floristic_new(floristic_post_raw)
# ============================================================================
# SUMMARY OF STANDARDIZED DATA
# ============================================================================
cat("\n=== STANDARDIZED DATA SUMMARY ===\n\n")
cat("BASELINE (ante - before 2025):\n")
cat("  Total records:", nrow(floristic_initial), "\n")
cat("  Unique taxa:", length(unique(floristic_initial$Taxon)), "\n")
cat("  Year range:", range(floristic_initial$year), "\n\n")
cat("UPDATED (post - after 2025):\n")
cat("  Total records:", nrow(floristic_updated), "\n")
cat("  Unique taxa:", length(unique(floristic_updated$Taxon)), "\n")
cat("  Year range:", range(floristic_updated$year), "\n\n")
cat("CHANGES:\n")
cat("  New observations added:", nrow(floristic_updated) - nrow(floristic_initial), "\n")
# Check for truly new taxa
taxa_initial <- unique(floristic_initial$Taxon)
taxa_updated <- unique(floristic_updated$Taxon)
new_taxa <- setdiff(taxa_updated, taxa_initial)
cat("  New taxa discovered:", length(new_taxa), "\n")
if (length(new_taxa) > 0 && length(new_taxa) <= 30) {
cat("\n  New taxa list:\n")
cat(paste("   -", sort(new_taxa)), sep = "\n")
}
# Check for infraspecific taxa
has_infraspecific <- function(taxon_name) {
name_lower <- tolower(as.character(taxon_name))
grepl("subsp\\.|var\\.|f\\.", name_lower)
}
n_infra_initial <- sum(sapply(floristic_initial$Taxon, has_infraspecific))
n_infra_updated <- sum(sapply(floristic_updated$Taxon, has_infraspecific))
cat("\n  Records with infraspecific ranks (subsp/var):\n")
cat("    Initial:", n_infra_initial, "\n")
cat("    Updated:", n_infra_updated, "\n")
# ============================================================================
# VISUAL CHECK
# ============================================================================
# Identify new records
floristic_initial$record_id <- paste(
floristic_initial$Taxon,
round(floristic_initial$Lat, 6),
round(floristic_initial$Long, 6),
floristic_initial$year,
sep = "_"
)
floristic_updated$record_id <- paste(
floristic_updated$Taxon,
round(floristic_updated$Lat, 6),
round(floristic_updated$Long, 6),
floristic_updated$year,
sep = "_"
)
new_records <- floristic_updated %>%
filter(!record_id %in% floristic_initial$record_id)
cat("\nNew records (not in baseline):", nrow(new_records), "\n")
cat("  From 2025:", sum(new_records$year == 2025), "\n")
cat("  From before 2025:", sum(new_records$year < 2025), "\n")
# Plot
plot(st_geometry(study_area), border = "black", lwd = 2,
main = "2025 Fieldwork - Standardized Nomenclature")
plot(st_geometry(floristic_initial), add = TRUE, col = "gray60", pch = 20, cex = 0.3)
plot(st_geometry(new_records), add = TRUE, col = "red", pch = 20, cex = 0.8)
legend("topright",
legend = c("Baseline (ante)", "New records (post)"),
col = c("gray60", "red"),
pch = 20,
pt.cex = c(0.3, 0.8))
# ============================================================================
# RUN MRFI COMPARISON
# ============================================================================
cat("\n=== RUNNING MRFI COMPARISON ===\n\n")
comparison_standardized <- compare_mrfi(
data_flor_initial = floristic_initial,
data_flor_updated = floristic_updated,
site = study_area,
tau = 20,
cellsize = 1000,
year_initial = max(floristic_initial$year),
year_updated = 2025,
use_coverage_weighting = FALSE,
output_prefix = "MSRM_2025_STANDARDIZED_NOMENCLATURE"
)
comparison_test <- compare_mrfi(
data_flor_initial = floristic_initial,
data_flor_updated = floristic_updated,
site = study_area,
tau = 20,
cellsize = 1000,
year_initial = max(floristic_initial_subset$year),
year_updated = 2025,
use_coverage_weighting = FALSE,
output_prefix = "MSRM_2025_TEST_QUADRANT-BIAS-FULL2"
)
comparison_test <- compare_mrfi(
data_flor_initial = floristic_initial,
data_flor_updated = floristic_updated,
site = study_area,
tau = 20,
cellsize = 2000,
year_initial = max(floristic_initial_subset$year),
year_updated = 2025,
use_coverage_weighting = FALSE,
output_prefix = "MSRM_2025_TEST_QUADRANT-BIAS-FULL2"
)
comparison_test <- compare_mrfi(
data_flor_initial = floristic_initial,
data_flor_updated = floristic_updated,
site = study_area,
tau = 40,
cellsize = 1000,
year_initial = max(floristic_initial_subset$year),
year_updated = 2025,
use_coverage_weighting = FALSE,
output_prefix = "MSRM_2025_TEST_QUADRANT-BIAS-FULL2"
)
source("~/R projects/ignobioR/R/taxon_raster_helpers.R", echo = TRUE)
devtools::clean_dll()
devtools::load_all()
source("~/R projects/ignobioR/R/ignorance_map.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/taxon_raster_helpers.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
devtools::clean_dll()
devtools::load_all()
source("~/R projects/ignobioR/R/ignorance_map.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/taxon_raster_helpers.R", echo = TRUE)
devtools::clean_dll()
devtools::load_all()
source("~/R projects/ignobioR/R/ignorance_map.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/taxon_raster_helpers.R", echo = TRUE)
devtools::clean_dll()
devtools::document()
devtools::install()
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
devtools::clean_dll()
devtools::install()
devtools::clean_dll()
devtools::install()
devtools::clean_dll()
devtools::install()
devtools::clean_dll()
devtools::install()
devtools::clean_dll()
devtools::document()
devtools::install()
devtools::install()
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/ignorance_map.R", echo = TRUE)
source("~/R projects/ignobioR/R/ignorance_per_taxon.R", echo = TRUE)
source("~/R projects/ignobioR/R/taxon_raster_helpers.R", echo = TRUE)
source("~/R projects/ignobioR/R/ignorance_incremental.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
p2_right <- add_boundaries(p2_right)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
warnings()
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
comparison_max_bias <- compare_mrfi(
data_flor_initial = data_flor_initial_T1,
data_flor_updated = data_flor_updated_T2,
site = study_area,
tau = MAX_DECAY_TAU,
cellsize = 1000,
year_initial = CUTOFF_YEAR,    # 2000
year_updated = YEAR_CURRENT,   # 2025
use_coverage_weighting = FALSE,
output_prefix = "MSRM_00-25_CLASSES-3"
)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
comparison_max_bias <- compare_mrfi(
data_flor_initial = data_flor_initial_T1,
data_flor_updated = data_flor_updated_T2,
site = study_area,
tau = MAX_DECAY_TAU,
cellsize = 1000,
year_initial = CUTOFF_YEAR,    # 2000
year_updated = YEAR_CURRENT,   # 2025
use_coverage_weighting = FALSE,
output_prefix = "MSRM_00-25_CLASSES-5"
)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
comparison_max_bias <- compare_mrfi(
data_flor_initial = data_flor_initial_T1,
data_flor_updated = data_flor_updated_T2,
site = study_area,
tau = 20,
cellsize = 1000,
year_initial = CUTOFF_YEAR,    # 2000
year_updated = YEAR_CURRENT,   # 2025
use_coverage_weighting = FALSE,
output_prefix = "MSRM_00-25_CLASSES-6"
)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
comparison_max_bias <- compare_mrfi(
data_flor_initial = data_flor_initial_T1,
data_flor_updated = data_flor_updated_T2,
site = study_area,
tau = 20,
year_initial = 2024,
year_updated = 2025,
cellsize = 1000,
use_coverage_weighting = FALSE,
output_prefix = "MSRM_COMPLETE_CLASSES-2"
)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/.active-rstudio-document", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
comparison_max_bias <- compare_mrfi(
data_flor_initial = data_flor_initial_T1,
data_flor_updated = data_flor_updated_T2,
site = study_area,
tau = 20,
year_initial = 2024,
year_updated = 2025,
cellsize = 1000,
use_coverage_weighting = FALSE,
output_prefix = "MSRM_COMPLETE_CLASSES-4"
)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
source("~/R projects/ignobioR/R/compare_mrfi.R", echo = TRUE)
comparison_max_bias <- compare_mrfi(
data_flor_initial = data_flor_initial_T1,
data_flor_updated = data_flor_updated_T2,
site = study_area,
tau = 20,
year_initial = 2024,
year_updated = 2025,
cellsize = 1000,
use_coverage_weighting = FALSE,
output_prefix = "MSRM_COMPLETE_CLASSES-5"
)
